From 041db6e3e1fdeb9773cc1cafc0891e234f9a6b3a Mon Sep 17 00:00:00 2001
From: Martin Kaesberger <git@skipfish.de>
Date: Mon, 15 Jun 2020 02:23:22 +0200
Subject: [PATCH 5/9] emit an emms instruction after using the mmx extension

---
 kernels/volk/volk_16i_32fc_dot_prod_32fc.h | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/kernels/volk/volk_16i_32fc_dot_prod_32fc.h b/kernels/volk/volk_16i_32fc_dot_prod_32fc.h
index 2635649..9246259 100644
--- a/kernels/volk/volk_16i_32fc_dot_prod_32fc.h
+++ b/kernels/volk/volk_16i_32fc_dot_prod_32fc.h
@@ -209,6 +209,8 @@ static inline void volk_16i_32fc_dot_prod_32fc_u_sse(lv_32fc_t* result,
         bPtr += 16;
     }
 
+    _mm_empty(); // clear the mmx technology state
+
     dotProdVal0 = _mm_add_ps(dotProdVal0, dotProdVal1);
     dotProdVal0 = _mm_add_ps(dotProdVal0, dotProdVal2);
     dotProdVal0 = _mm_add_ps(dotProdVal0, dotProdVal3);
@@ -484,6 +486,8 @@ static inline void volk_16i_32fc_dot_prod_32fc_a_sse(lv_32fc_t* result,
         bPtr += 16;
     }
 
+    _mm_empty(); // clear the mmx technology state
+
     dotProdVal0 = _mm_add_ps(dotProdVal0, dotProdVal1);
     dotProdVal0 = _mm_add_ps(dotProdVal0, dotProdVal2);
     dotProdVal0 = _mm_add_ps(dotProdVal0, dotProdVal3);
-- 
2.20.1

